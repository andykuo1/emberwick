!function(e){function t(t){for(var r,o,i=t[0],a=t[1],s=t[2],u=0,l=[];u<i.length;u++)o=i[u],M[o]&&l.push(M[o][0]),M[o]=0;for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r]);for(D&&D(t);l.length;)l.shift()();return j.push.apply(j,s||[]),n()}function n(){for(var e,t=0;t<j.length;t++){for(var n=j[t],r=!0,o=1;o<n.length;o++){var i=n[o];0!==M[i]&&(r=!1)}r&&(j.splice(t--,1),e=T(T.s=n[0]))}return e}var r=window.webpackHotUpdate;window.webpackHotUpdate=function(e,t){!function(e,t){if(!b[e]||!w[e])return;for(var n in w[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(v[n]=t[n]);0==--_&&0===g&&S()}(e,t),r&&r(e,t)};var o,i=!0,a="c32d8c552f31a52e9887",s=1e4,u={},l=[],c=[];var f=[],h="idle";function d(e){h=e;for(var t=0;t<f.length;t++)f[t].call(null,e)}var p,v,y,_=0,g=0,m={},w={},b={};function E(e){return+e+""===e?+e:e}function k(e){if("idle"!==h)throw new Error("check() is only allowed in idle status");return i=e,d("check"),function(e){return e=e||1e4,new Promise(function(t,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,o=T.p+""+a+".hot-update.json";r.open("GET",o,!0),r.timeout=e,r.send(null)}catch(e){return n(e)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+o+" timed out."));else if(404===r.status)t();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+o+" failed."));else{try{var e=JSON.parse(r.responseText)}catch(e){return void n(e)}t(e)}}})}(s).then(function(e){if(!e)return d("idle"),null;w={},m={},b=e.c,y=e.h,d("prepare");var t=new Promise(function(e,t){p={resolve:e,reject:t}});for(var n in v={},M)O(n);return"prepare"===h&&0===g&&0===_&&S(),t})}function O(e){b[e]?(w[e]=!0,_++,function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.charset="utf-8",n.src=T.p+""+e+"."+a+".hot-update.js",t.appendChild(n)}(e)):m[e]=!0}function S(){d("ready");var e=p;if(p=null,e)if(i)Promise.resolve().then(function(){return P(i)}).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var n in v)Object.prototype.hasOwnProperty.call(v,n)&&t.push(E(n));e.resolve(t)}}function P(t){if("ready"!==h)throw new Error("apply() is only allowed in ready status");var n,r,o,i,s;function c(e){for(var t=[e],n={},r=t.slice().map(function(e){return{chain:[e],id:e}});r.length>0;){var o=r.pop(),a=o.id,s=o.chain;if((i=x[a])&&!i.hot._selfAccepted){if(i.hot._selfDeclined)return{type:"self-declined",chain:s,moduleId:a};if(i.hot._main)return{type:"unaccepted",chain:s,moduleId:a};for(var u=0;u<i.parents.length;u++){var l=i.parents[u],c=x[l];if(c){if(c.hot._declinedDependencies[a])return{type:"declined",chain:s.concat([l]),moduleId:a,parentId:l};-1===t.indexOf(l)&&(c.hot._acceptedDependencies[a]?(n[l]||(n[l]=[]),f(n[l],[a])):(delete n[l],t.push(l),r.push({chain:s.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}t=t||{};var p={},_=[],g={},m=function(){console.warn("[HMR] unexpected require("+k.moduleId+") to disposed module")};for(var w in v)if(Object.prototype.hasOwnProperty.call(v,w)){var k;s=E(w);var O=!1,S=!1,P=!1,j="";switch((k=v[w]?c(s):{type:"disposed",moduleId:w}).chain&&(j="\nUpdate propagation: "+k.chain.join(" -> ")),k.type){case"self-declined":t.onDeclined&&t.onDeclined(k),t.ignoreDeclined||(O=new Error("Aborted because of self decline: "+k.moduleId+j));break;case"declined":t.onDeclined&&t.onDeclined(k),t.ignoreDeclined||(O=new Error("Aborted because of declined dependency: "+k.moduleId+" in "+k.parentId+j));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(k),t.ignoreUnaccepted||(O=new Error("Aborted because "+s+" is not accepted"+j));break;case"accepted":t.onAccepted&&t.onAccepted(k),S=!0;break;case"disposed":t.onDisposed&&t.onDisposed(k),P=!0;break;default:throw new Error("Unexception type "+k.type)}if(O)return d("abort"),Promise.reject(O);if(S)for(s in g[s]=v[s],f(_,k.outdatedModules),k.outdatedDependencies)Object.prototype.hasOwnProperty.call(k.outdatedDependencies,s)&&(p[s]||(p[s]=[]),f(p[s],k.outdatedDependencies[s]));P&&(f(_,[k.moduleId]),g[s]=m)}var C,A=[];for(r=0;r<_.length;r++)s=_[r],x[s]&&x[s].hot._selfAccepted&&A.push({module:s,errorHandler:x[s].hot._selfAccepted});d("dispose"),Object.keys(b).forEach(function(e){!1===b[e]&&function(e){delete M[e]}(e)});for(var I,D,L=_.slice();L.length>0;)if(s=L.pop(),i=x[s]){var R={},U=i.hot._disposeHandlers;for(o=0;o<U.length;o++)(n=U[o])(R);for(u[s]=R,i.hot.active=!1,delete x[s],delete p[s],o=0;o<i.children.length;o++){var Y=x[i.children[o]];Y&&((C=Y.parents.indexOf(s))>=0&&Y.parents.splice(C,1))}}for(s in p)if(Object.prototype.hasOwnProperty.call(p,s)&&(i=x[s]))for(D=p[s],o=0;o<D.length;o++)I=D[o],(C=i.children.indexOf(I))>=0&&i.children.splice(C,1);for(s in d("apply"),a=y,g)Object.prototype.hasOwnProperty.call(g,s)&&(e[s]=g[s]);var K=null;for(s in p)if(Object.prototype.hasOwnProperty.call(p,s)&&(i=x[s])){D=p[s];var F=[];for(r=0;r<D.length;r++)if(I=D[r],n=i.hot._acceptedDependencies[I]){if(-1!==F.indexOf(n))continue;F.push(n)}for(r=0;r<F.length;r++){n=F[r];try{n(D)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:s,dependencyId:D[r],error:e}),t.ignoreErrored||K||(K=e)}}}for(r=0;r<A.length;r++){var N=A[r];s=N.module,l=[s];try{T(s)}catch(e){if("function"==typeof N.errorHandler)try{N.errorHandler(e)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:s,error:n,originalError:e}),t.ignoreErrored||K||(K=n),K||(K=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:s,error:e}),t.ignoreErrored||K||(K=e)}}return K?(d("fail"),Promise.reject(K)):(d("idle"),new Promise(function(e){e(_)}))}var x={},M={0:0},j=[];function T(t){if(x[t])return x[t].exports;var n=x[t]={i:t,l:!1,exports:{},hot:function(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:o!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:k,apply:P,status:function(e){if(!e)return h;f.push(e)},addStatusHandler:function(e){f.push(e)},removeStatusHandler:function(e){var t=f.indexOf(e);t>=0&&f.splice(t,1)},data:u[e]};return o=void 0,t}(t),parents:(c=l,l=[],c),children:[]};return e[t].call(n.exports,n,n.exports,function(e){var t=x[e];if(!t)return T;var n=function(n){return t.hot.active?(x[n]?-1===x[n].parents.indexOf(e)&&x[n].parents.push(e):(l=[e],o=n),-1===t.children.indexOf(n)&&t.children.push(n)):(console.warn("[HMR] unexpected require("+n+") from disposed module "+e),l=[]),T(n)},r=function(e){return{configurable:!0,enumerable:!0,get:function(){return T[e]},set:function(t){T[e]=t}}};for(var i in T)Object.prototype.hasOwnProperty.call(T,i)&&"e"!==i&&"t"!==i&&Object.defineProperty(n,i,r(i));return n.e=function(e){return"ready"===h&&d("prepare"),g++,T.e(e).then(t,function(e){throw t(),e});function t(){g--,"prepare"===h&&(m[e]||O(e),0===g&&0===_&&S())}},n.t=function(e,t){return 1&t&&(e=n(e)),T.t(e,-2&t)},n}(t)),n.l=!0,n.exports}T.m=e,T.c=x,T.d=function(e,t,n){T.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},T.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},T.t=function(e,t){if(1&t&&(e=T(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(T.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)T.d(n,r,function(t){return e[t]}.bind(null,r));return n},T.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return T.d(t,"a",t),t},T.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},T.p="dist/",T.h=function(){return a};var C=window.webpackJsonp=window.webpackJsonp||[],A=C.push.bind(C);C.push=t,C=C.slice();for(var I=0;I<C.length;I++)t(C[I]);var D=A;j.push([17,1]),n()}([,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.assetManager=t,this._cache=new Map,this._loadQueue=new Map,this._cacheOnly=new Set,this._baseUrl=n,this._responseType=r}return r(e,[{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this._cache.keys()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;this.unload(i)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}this._loadQueue.clear(),this._cache.clear(),this._cacheOnly.clear()}},{key:"onLoadResource",value:function(e,t,n){return Promise.resolve(e)}},{key:"onUnloadResource",value:function(e,t){}},{key:"load",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=this,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(this._cache.has(e))throw new Error("Asset with url '"+e+"' is already loaded");if(this._loadQueue.has(e))throw new Error("Asset with url '"+e+"' is already loading");var s={promise:null,request:null};return this._cache.set(e,this.getDefaultAsset()),this._loadQueue.set(e,s),s.promise=new Promise(function(u,l){var c=o._baseUrl+e,f=s.request=new XMLHttpRequest;f.responseType=o._responseType,f.onreadystatechange=function(r){if(f.readyState===XMLHttpRequest.DONE)if(200===f.status)o.onLoadResource(f.response,t,e).then(function(t){console.log("[AssetLoader] Successfully loaded resource: '"+e+"'."),o.cache(e,t,!1,!0,!0),u(t)}).catch(function(t){console.log("[AssetLoader] Failed loading resource: '"+e+"'."),o.unload(e,a,!0),n&&n(t),l(t)});else{o.unload(e,a,!0);var i=new Error("Failed to load resource from server - "+f.status);n&&n(i),l(i)}},f.onerror=function(t){o.unload(e,a,!0);var r=new Error("Failed to load resource from server due to network error");n&&n(r),l(r)},f.oncancel=function(t){o.unload(e,!1,!0),r&&r(t),u(null)},i&&(f.onprogress=function(e){e.lengthComputable&&i(e)}),f.open("GET",c,!0),f.send()}),s.promise}},{key:"cache",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!(arguments.length>4&&void 0!==arguments[4]&&arguments[4])&&this._cache.has(e))throw new Error("Asset with url '"+e+"' is already cached");if(this._loadQueue.has(e)){if(!r)throw new Error("Asset with url '"+e+"' is already being loaded");this._loadQueue.delete(e)}n&&this._cacheOnly.add(e),this._cache.set(e,t)}},{key:"reload",value:function(e,t){if(!this._cache.has(e))throw new Error("Cannot find asset with url '"+e+"' to reload");if(this._cacheOnly.has(e))throw new Error("Trying to reload cache-only asset with url '"+e+"'");this._loadQueue.has(e)||(this.unload(e),this.load(e,t))}},{key:"unload",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._cache.has(e))throw new Error("Cannot find asset with url '"+e+"' to unload");if(this._loadQueue.has(e)&&(n?this._loadQueue.delete(e):this._loadQueue.get(e).request.abort()),t){var r=this._cache.get(e);this.onUnloadResource(r,e),this._cacheOnly.has(e)&&this._cacheOnly.delete(e),this._cache.delete(e)}}},{key:"hasAsset",value:function(e){return this._cache.has(e)}},{key:"getAsset",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._loadQueue.has(e)?this._loadQueue.get(e):this._cache.has(e)?Promise.resolve(this._cache.get(e)):t?this.load(e,null):Promise.resolve(this.getDefaultAsset())}},{key:"getAssetImmediately",value:function(e){return this._cache.has(e)?this._cache.get(e):this.getDefaultAsset()}},{key:"getDefaultAsset",value:function(){return null}},{key:"isAssetLoading",value:function(e){return this._loadQueue.has(e)}},{key:"isAssetFullyLoaded",value:function(e){return this._cache.has(e)&&!this._loadQueue.has(e)}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={__eventListeners:null,__events:null,__immediate:!0,__autoregister:!1,mixin:function(e){var t=e.prototype;Object.assign(t,r),delete t.mixin},allowImmediateEventUpdate:function(e){return this.__immediate=e,this},allowAutomaticEventRegister:function(e){return this.__autoregister=e,this},pollEvents:function(){if(this.__eventQueue)for(var e=100;this.__eventQueue.length>0&&--e>=0;){var t=this.__eventQueue.pop(),n=t[0],r=t[1];this.processEvent(n,r)}},processEvent:function(e,t){for(var n=this.__eventListeners.get(e),r=null,o=n.length;o--;){try{r=n[o].apply(null,t)}catch(e){console.error(e)}if(!0===r)break}},registerEvent:function(e){if(this.__eventListeners||(this.__eventListeners=new Map),this.__eventListeners.has(e))throw new Error("Already registered event '"+e+"'");this.__eventListeners.set(e,[])},unregisterEvent:function(e){if(this.__eventListeners){if(!this.__eventListeners.has(e))throw new Error("Unable to find event '"+e+"'");this.__eventListeners.delete(e)}},addEventListener:function(e,t){this.__eventListeners||(this.__eventListeners=new Map);var n=void 0;if(this.__eventListeners.has(e))n=this.__eventListeners.get(e);else{if(!this.__autoregister)throw new Error("Unable to find event '"+e+"'");n=[],this.__eventListeners.set(e,n)}n.push(t)},removeEventListener:function(e,t){if(this.__eventListeners){if(!this.__eventListeners.has(e))throw new Error("Unknown event '"+e+"'");for(var n=this.__eventListeners.get(e),r=!1,o=n.length;o--;)n[o]===t&&(n.splice(o,1),r=!0);if(!r)throw new Error("Unable to find listener for event '"+e+"'")}},clearEventListeners:function(e){if(this.__eventListeners)if(this.__eventListeners.has(e)){this.__eventListeners.get(e).length=0}else{if(!this.__autoregister)throw new Error("Unable to find event '"+e+"'");listeners=[],this.__eventListeners.set(e,listeners)}},countEventListeners:function(e){return this.__eventListeners&&this.__eventListeners.has(e)?this.__eventListeners.get(e).length:0},getEventListeners:function(e){return this.__eventListeners?this.__eventListeners.get(e):null},on:function(e,t){this.addEventListener(e,t)},once:function(e,t){var n=this;this.addEventListener(e,function r(){for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];try{t.apply(null,i)}finally{n.removeEventListener(e,r)}})},emit:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];try{if(!this.__eventListeners)return;var o=void 0;if(this.__eventListeners.has(e))o=this.__eventListeners.get(e);else{if(!this.__autoregister)throw new Error("Unable to find event '"+e+"'");o=[],this.__eventListeners.set(e,o)}this.__immediate?this.processEvent(e,n):(this.__eventQueue||(this.__eventQueue=[]),this.__eventQueue.push([e,n]))}finally{this.onEventProcessed.apply(this,[e].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n)))}},onEventProcessed:function(e){}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=function(e){return e&&e.__esModule?e:{default:e}}(n(4));var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._otherID=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"onContextRegister",value:function(e,n){if(null==this._inputID)o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onContextRegister",this).call(this,e,n);else if(null==this._otherID){if(this._context!=e)throw new Error("Cannot register state input calls to another context");this._otherID=n}}},{key:"onContextUnregister",value:function(e,n){n==this._inputID?this._inputID=null:n==this._otherID&&(this._otherID=null),null==this._inputID&&null==this._otherID&&o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onContextUnregister",this).call(this,e,n)}},{key:"processInput",value:function(e){if(null==this._otherID)throw new Error("Missing another registered input call for state input");return e.id==this._inputID||e.id!=this._otherID&&null}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this._context=null,this._inputID=null}return r(e,[{key:"onContextRegister",value:function(e,t){if(null!=this._context)throw new Error("Cannot register input already registered with another context");this._context=e,this._inputID=t}},{key:"onContextUnregister",value:function(e,t){this._context=null,this._inputID=null}},{key:"processInput",value:function(e){return e}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCanvas=function(e){o.canvas=e,o.gl=e.getContext("webgl")},t.setRootState=function(e){if(null!==o.rootState)throw new Error("App root state already exists");o.running?e.init().then(function(){console.log("[App] New GameState initialized."),o.rootState=e}):o.rootState=e;return e},t.initialize=function(){if(null===o.canvas)throw new Error("Invalid canvas target");if(null===o.gl)throw new Error("Invalid canvas context target");return o.rootState?o.rootState.init().then(function(){console.log("[App] New GameState initialized."),o.running=!0,window.requestAnimationFrame(i)}):(console.log("[App] No GameState found."),o.running=!0,window.requestAnimationFrame(i),Promise.resolve())},t.terminate=function(){if(!o.running)return;o.running=!1,o.rootState&&(o.rootState.exit(!0,!0),o.rootState=null)};var r=t.FRAMES_PER_SECOND=60,o=t.INSTANCE={rootState:null,running:!1,canvas:null,gl:null,dt:0,prevtime:0};function i(e){if(o.running){o.dt=e-o.prevtime;var t=o.rootState;t&&t.canUpdate()&&t.update(o.dt/r),FPS.update(o.dt),o.prevtime=e,window.requestAnimationFrame(i)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(2));var i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DefaultState";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this._prevState=null,this._nextState=null,this._cacheNextState=null,this._cacheExit=!1,this._isLoaded=!1,this._suspended=!1,this.registerEvent("load"),this.registerEvent("unload")}return r(e,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._isLoaded)throw new Error("Cannot initialize state already loaded");if(null!==this._prevState)throw new Error("Cannot initialize state already initialized from another state");this._prevState=t,console.log("[GameState] Loading game state '"+this.name+"'...");var r=this.onLoad().then(function(t){return e._isLoaded=!0,e.emit("load",e),t});return n?r.then(function(t){console.log("[GameState] Starting game state '"+e.name+"'..."),e.onStart()}):r}},{key:"update",value:function(e){if(!this._isLoaded)throw new Error("Trying to update state that is not yet loaded");if(this.onGameUpdate(e),this._suspended||this.onUpdate(e),null!==this._nextState&&this._nextState.update(e),this._cacheExit)console.log("[GameState] Exiting game state '"+this.name+"'..."),this._cacheExit=!1,this._exitGameState();else if(null!==this._cacheNextState){console.log("[GameState] Changing game state for '"+this.name+"'...");var t=this._cacheNextState;this._cacheNextState=null,this._nextGameState(t)}}},{key:"suspend",value:function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&!this._isLoaded)throw new Error("Trying to suspend state that is not yet initialized");this._suspended||(console.log("[GameState] Suspending game state '"+this.name+"'..."),this._suspended=!0,this.onSuspend())}},{key:"resume",value:function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&!this._isLoaded)throw new Error("Trying to resume state that is not yet initialized");this._suspended&&(console.log("[GameState] Resuming game state '"+this.name+"'..."),this._suspended=!1,this.onResume())}},{key:"exit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._isLoaded)throw new Error("Trying to exit state that is not yet loaded");if(!e&&null!==this._nextState)throw new Error("Trying to exit a dependent state");t?(console.log("[GameState] Exiting game state '"+this.name+"'..."),this._exitGameState()):this._cacheExit=!0}},{key:"nextGameState",value:function(e){if(null!==this._cacheNextState)throw new Error("Trying to set multiple next states");if(this.isValidNextGameState(e))return this._cacheNextState=e,e;throw new Error("Invalid next game state")}},{key:"getNextGameState",value:function(){return this._nextState}},{key:"getPrevGameState",value:function(){return this._prevState}},{key:"canUpdate",value:function(){return this._isLoaded}},{key:"_nextGameState",value:function(e){var t=this;return e.init(this,!1).then(function(n){t.suspend(),t._nextState=n,console.log("[GameState] Starting next game state for '"+t.name+"'..."),e.onStart()})}},{key:"_exitGameState",value:function(){null!==this._nextState&&(console.log("[GameState] Exiting child game state for '"+this.name+"'..."),this._nextState._exitGameState(),this._nextState=null),console.log("[GameState] Stopping game state '"+this.name+"'...");try{this.onStop()}catch(e){console.error(e)}if(null!==this._prevState&&(this._prevState._nextState=null,this._prevState.resume()),null!==this._cacheNextState){if(null===this._prevState)throw new Error("Cannot replace current state while exiting the root state");this._prevState.nextGameState(this._cacheNextState)}this._prevState=null,console.log("[GameState] Unloading game state '"+this.name+"'...");try{this.onUnload()}catch(e){console.error(e)}this._isLoaded=!1,this._suspended=!1,this.emit("unload",this)}},{key:"onGameUpdate",value:function(e){}},{key:"onLoad",value:function(){return Promise.resolve(this)}},{key:"onStart",value:function(){}},{key:"onUpdate",value:function(e){}},{key:"onSuspend",value:function(){}},{key:"onResume",value:function(){}},{key:"onStop",value:function(){}},{key:"onUnload",value:function(){}},{key:"isValidNextGameState",value:function(t){return t instanceof e}}]),e}();o.default.mixin(i),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=c(n(6)),i=c(n(8)),a=c(n(19)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(9)),u=(c(n(10)),c(n(3))),l=c(n(11));function c(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PlayableGameState";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.inputManager=null,n.sceneGraph=null,n.inputContext=null,n.onInputUpdate=n.onInputUpdate.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"onLoad",value:function(){var e=this.getPrevGameState();return this.inputManager=e.inputManager,this.inputContext=new a.default,this.onInputSetup(this.inputContext),this.inputManager.addContext(this.inputContext),this.inputManager.addCallback(this.onInputUpdate),this.sceneGraph=new i.default,function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onLoad",this).call(this)}},{key:"onInputSetup",value:function(e){e.registerState("key","down",s.KEY_SPACE,"key","up",s.KEY_SPACE,new u.default("moveUp")),e.registerState("key","down",s.KEY_E,"key","up",s.KEY_E,new u.default("moveDown")),e.registerState("key","down",s.KEY_A,"key","up",s.KEY_A,new u.default("strafeLeft")),e.registerState("key","down",s.KEY_D,"key","up",s.KEY_D,new u.default("strafeRight")),e.registerState("key","down",s.KEY_W,"key","up",s.KEY_W,new u.default("moveForward")),e.registerState("key","down",s.KEY_S,"key","up",s.KEY_S,new u.default("moveBackward")),e.registerRange("mouse","move",s.MOUSE_X,new l.default("lookX",-1,1)),e.registerRange("mouse","move",s.MOUSE_Y,new l.default("lookY",-1,1))}},{key:"onInputUpdate",value:function(e){}},{key:"onUnload",value:function(){this.inputManager.removeCallback(this.onInputUpdate),this.inputManager.removeContext(this.inputContext)}},{key:"getSceneGraph",value:function(){return this.sceneGraph}}]),t}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parent=null,this.children=[],this.transform=o.mat4.create(),this.worldTransform=o.mat4.create(),this.color=o.vec4.create(),this.modelScale=o.vec3.fromValues(1,1,1),this.mesh=t}return r(e,[{key:"delete",value:function(){if(this.isParent()){var e=!0,t=!1,n=void 0;try{for(var r,o=this.children[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.delete()}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}this.children.length=0}this.setParent(null)}},{key:"update",value:function(e){this._parent?o.mat4.mul(this.worldTransform,this._parent.worldTransform,this.transform):o.mat4.copy(this.worldTransform,this.transform);var t=!0,n=!1,r=void 0;try{for(var i,a=this.children[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.update(e)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"isParent",value:function(){return this.children.length>0}},{key:"setParent",value:function(e){null!=this._parent&&this._parent.children.splice(this,1),null!=e&&e.children.push(this),this._parent=e}},{key:"getParent",value:function(){return this._parent}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MOUSE_X=-1,t.MOUSE_Y=-2,t.MOUSE_WHEEL_X=-3,t.MOUSE_WHEEL_Y=-4,t.MOUSE_LEFT=1,t.MOUSE_MIDDLE=2,t.MOUSE_RIGHT=3,t.KEY_LEFT=37,t.KEY_RIGHT=39,t.KEY_UP=38,t.KEY_DOWN=40,t.KEY_SPACE=32,t.KEY_TAB=9,t.KEY_ENTER=13,t.KEY_SHIFT=16,t.KEY_COLON=186,t.KEY_EQUAL=187,t.KEY_COMMA=188,t.KEY_DASH=189,t.KEY_PERIOD=190,t.KEY_FORWARD_SLASH=191,t.KEY_BACK_SLASH=220,t.KEY_GRAVE=192,t.KEY_OPEN_BRACKET=219,t.KEY_CLOSE_BRACKET=221,t.KEY_QUOTE=222,t.KEY_0=48,t.KEY_1=49,t.KEY_2=50,t.KEY_3=51,t.KEY_4=52,t.KEY_5=53,t.KEY_6=54,t.KEY_7=55,t.KEY_8=56,t.KEY_9=57,t.KEY_A=65,t.KEY_B=66,t.KEY_C=67,t.KEY_D=68,t.KEY_E=69,t.KEY_F=70,t.KEY_G=71,t.KEY_H=72,t.KEY_I=73,t.KEY_J=74,t.KEY_K=75,t.KEY_L=76,t.KEY_M=77,t.KEY_N=78,t.KEY_O=79,t.KEY_P=80,t.KEY_Q=81,t.KEY_R=82,t.KEY_S=83,t.KEY_T=84,t.KEY_U=85,t.KEY_V=86,t.KEY_W=87,t.KEY_X=88,t.KEY_Y=89,t.KEY_Z=90},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(4));var i=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"processInput",value:function(e){return!0}}]),t}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(4));var i=function(e){function t(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));if("number"!=typeof r||"number"!=typeof n)throw new Error("Range bounds for input not specified");if(r<n)throw new Error("Max range must be greater than min range");i.min=n,i.max=r;var a=r-n;if(0==a)throw new Error("Range of input cannot be zero");return i._normal=a,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"processInput",value:function(e){return this.normalize(e.amount)}},{key:"normalize",value:function(e){return(e-this.min)/this._normal}}]),t}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(2));var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mousedown",this.onMouseDown,!1),document.addEventListener("mouseup",this.onMouseUp,!1),this.onMouseClick=this.onMouseClick.bind(this),t.addEventListener("click",this.onMouseClick,!1),this.canvas=t,this.registerEvent("move"),this.registerEvent("down"),this.registerEvent("up")}return r(e,[{key:"delete",value:function(){this.hasPointerLock()&&document.exitPointerLock(),this.unregisterEvent("move"),this.unregisterEvent("down"),this.unregisterEvent("up"),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("click",this.onMouseClick)}},{key:"onMouseClick",value:function(e){this.canvas.requestPointerLock()}},{key:"onMouseMove",value:function(e){this.hasPointerLock()&&this.emit("move",e)}},{key:"onMouseDown",value:function(e){this.hasPointerLock()&&this.emit("down",e)}},{key:"onMouseUp",value:function(e){this.hasPointerLock()&&this.emit("up",e)}},{key:"hasPointerLock",value:function(){return document.pointerLockElement===this.canvas}}]),e}();o.default.mixin(i),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(2));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.registerEvent("down"),this.registerEvent("up")}return r(e,[{key:"delete",value:function(){this.unregisterEvent("up"),this.unregisterEvent("down"),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"onKeyDown",value:function(e){this.emit("down",e)}},{key:"onKeyUp",value:function(e){this.emit("up",e)}}]),e}();o.default.mixin(i),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(15));var i=0,a=function(){function e(t,n,r,a,s,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),++i,this.positions=new o.default(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this.positions.bindData(r),this.texcoords=new o.default(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this.texcoords.bindData(a),this.normals=new o.default(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this.normals.bindData(s),this.indices=new o.default(t,t.ELEMENT_ARRAY_BUFFER,t.STATIC_DRAW),this.indices.bindData(u),this.elementType=n,this.vertexCount=u.length,this._gl=t}return r(e,[{key:"delete",value:function(){this.positions.delete(),this.texcoords.delete(),this.normals.delete(),this.indices.delete(),--i<=0&&console.log("[Mesh] All resources are released! Hooray!")}},{key:"bind",value:function(e){this._gl;e.attachVertexBuffer(e.attributes.a_position,this.positions),e.attachVertexBuffer(e.attributes.a_texcoord,this.texcoords),e.attachVertexBuffer(e.attributes.a_normal,this.normals),this.indices.bind()}},{key:"draw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.drawElements(this.elementType,this.vertexCount,e.UNSIGNED_SHORT,t)}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=t.createBuffer();this._gl=t,this._handle=o,this.type=n,this.drawMode=r,this.dataType=t.BYTE}return r(e,[{key:"delete",value:function(){var e=this._gl,t=this._handle;e.deleteBuffer(t),this._handle=0}},{key:"bind",value:function(){this._gl.bindBuffer(this.type,this._handle)}},{key:"unbind",value:function(){this._gl.bindBuffer(this.type,0)}},{key:"bindData",value:function(e){var t=this._gl;if(e instanceof Float32Array)this.dataType=t.FLOAT,t.bindBuffer(this.type,this._handle),t.bufferData(this.type,e,this.drawMode);else{if(!(e instanceof Uint16Array))throw new Error("Unsupported buffer data type");this.dataType=t.UNSIGNED_SHORT,t.bindBuffer(this.type,this._handle),t.bufferData(this.type,e,this.drawMode)}return this}},{key:"handle",get:function(){return this._handle}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(8));var o={initialize:function(){this._sceneNode=new r.default,this.getTransform=function(){return this._sceneNode.transform}.bind(this)},terminate:function(){this._sceneNode&&this._sceneNode.delete(),this._sceneNode=void 0,this.getTransform=void 0}};t.default=o},function(e,t,n){"use strict";var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(5)),o=a(n(18)),i=a(n(39));function a(e){return e&&e.__esModule?e:{default:e}}window.addEventListener("load",function(e){r.setCanvas(document.getElementById("glCanvas")),r.setRootState(new o.default).nextGameState(new i.default),r.initialize()}),window.addEventListener("beforeunload",function(e){r.terminate()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=_(n(6)),i=_(n(7)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(5)),s=_(n(12)),u=_(n(13)),l=_(n(20)),c=_(n(22)),f=_(n(23)),h=_(n(27)),d=_(n(28)),p=_(n(29)),v=_(n(31)),y=_(n(32));function _(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"GameStart"));return e.canvas=null,e.gl=null,e.renderer=null,e.assets=null,e.entityManager=null,e.inputManager=null,e.mouse=null,e.keyboard=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"onLoad",value:function(){var e=this,t=new c.default,n=window.location+"res/";t.registerAssetLoader("vert",new h.default(t,n)),t.registerAssetLoader("frag",new h.default(t,n)),t.registerAssetLoader("image",new d.default(t,n)),t.registerAssetLoader("obj",new v.default(t,n)),this.assets=t,this.entityManager=new f.default,this.inputManager=new l.default;var r=this.canvas=a.INSTANCE.canvas,o=this.gl=a.INSTANCE.gl;return t.registerAssetLoader("mesh",new p.default(t,o)),this.mouse=new s.default(r),this.keyboard=new u.default,this.inputManager.setMouse(this.mouse),this.inputManager.setKeyboard(this.keyboard),this.renderer=new y.default(t),new Promise(function(t,n){e.renderer.load(o,function(){return t(e)})})}},{key:"onStart",value:function(){}},{key:"onGameUpdate",value:function(e){this.inputManager.doInputUpdate(),this.entityManager.update(e);var t=this.getNextGameState();t&&this.renderer.render(this.gl,t)}},{key:"onUpdate",value:function(e){}},{key:"onSuspend",value:function(){}},{key:"onResume",value:function(){}},{key:"onStop",value:function(){}},{key:"onUnload",value:function(){this.entityManager.clear(),this.renderer.unload(this.gl),this.keyboard.delete(),this.mouse.delete(),this.assets.clear()}},{key:"isValidNextGameState",value:function(e){return function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"isValidNextGameState",this).call(this,e)&&e instanceof i.default}}]),t}();t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e){e&&e.__esModule}(n(3));var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mapping=new Map,this._activeStates=[]}return r(e,[{key:"registerAction",value:function(e,t,n,r){this.registerInputByID(i(e,t,n),r)}},{key:"unregisterAction",value:function(e){return this.unregisterInputByID(e._inputID,e)}},{key:"registerState",value:function(e,t,n,r,o,a,s){var u=i(e,t,n),l=i(r,o,a);this.registerInputByID(u,s),this.registerInputByID(l,s)}},{key:"unregisterState",value:function(e){this.unregisterInputByID(e._otherID,e),this.unregisterInputByID(e._inputID,e)}},{key:"registerRange",value:function(e,t,n,r){this.registerInputByID(i(e,t,n),r)}},{key:"unregisterRange",value:function(e){return this.unregisterInputByID(e._inputID,e)}},{key:"registerInputByID",value:function(e,t){if(!e)throw new Error("Cannot register input to empty input id");var n=void 0;return this._mapping.has(e)?n=this._mapping.get(e):this._mapping.set(e,n=[]),n.push(t),t.onContextRegister(this,e),t}},{key:"unregisterInputByID",value:function(e,t){if(this._mapping.has(e)){var n=this._mapping.get(e);if(n.includes(t))return n.splice(n.indexOf(t),1),t.onContextUnregister(this,e),!0}return!1}},{key:"onInputUpdate",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this._activeStates[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;e.setState(a)}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}},{key:"setActiveState",value:function(e,t){var n=this._activeStates;t?n.includes(e)||n.push(e):n.includes(e)&&n.splice(n.indexOf(e),1)}},{key:"getMappedInputs",value:function(e,t,n){return this._mapping.get(i(e,t,n))}}]),e}();function i(e,t,n){if(!e)throw new Error("Cannot get input id for non-existent input source");if(!n)throw new Error("Cannot get input id for non-existent key code");if(!t)throw new Error("Cannot get input id for non-existent event type");return e+"."+t+"."+n}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(l(n(12)),l(n(13)),l(n(21))),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(9)),a=l(n(10)),s=l(n(3)),u=l(n(11));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._inputEvent={id:null,down:!1,amount:0},this._contexts=[],this._callbacks=[],this._priorityComparator=function(e,t){return e[1]-t[1]},this._inputFrame=new o.default,this._mouse=null,this._mousedown=null,this._mouseup=null,this._mousemove=null,this._keyboard=null,this._keyup=null,this._keydown=null,this._gamepad=null}return r(e,[{key:"setKeyboard",value:function(e){var t=this;null!=this._keyboard&&(this._keyboard.removeEventListener("down",this._keydown),this._keyboard.removeEventListener("up",this._keyup),this._keyboard=null),this._keydown=function(e){e.repeat||t.onInput("key","down",e.which)},this._keyup=function(e){t.onInput("key","up",e.which)},e.on("down",this._keydown),e.on("up",this._keyup),this._keyboard=e}},{key:"setMouse",value:function(e){var t=this;null!=this._mouse&&(this._mouse.removeEventListener("down",this._mousedown),this._mouse.removeEventListener("up",this._mouseup),this._mouse.removeEventListener("move",this._mousemove),this._mouse=null),this._mousedown=function(e){e.repeat||t.onInput("mouse","down",e.which)},this._mouseup=function(e){t.onInput("mouse","up",e.which)},this._mousemove=function(e){t.onInput("mouse","move",i.MOUSE_X,e.movementX),t.onInput("mouse","move",i.MOUSE_Y,e.movementY)},e.on("down",this._mousedown),e.on("up",this._mouseup),e.on("move",this._mousemove),this._mouse=e}},{key:"setGamePad",value:function(e){throw new Error("Sorry, not yet supported.")}},{key:"addContext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._contexts.push([e,t]),this._contexts.sort(this._priorityComparator),e}},{key:"removeContext",value:function(e){for(var t=this._contexts.length;t--;)if(this._contexts[t][0]==e)return this._contexts.splice(t,1),!0;return!1}},{key:"addCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._callbacks.push([e,t]),this._callbacks.sort(this._priorityComparator),e}},{key:"removeCallback",value:function(e){for(var t=this._callbacks.length;t--;)if(this._callbacks[t][0]==e)return this._callbacks.splice(t,1),!0;return!1}},{key:"doInputUpdate",value:function(){var e=this._inputFrame,t=!0,n=!1,r=void 0;try{for(var o,i=this._contexts[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value[0].onInputUpdate(e)}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}var a=!0,s=!1,u=void 0;try{for(var l,c=this._callbacks[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){(0,l.value[0])(e)}}catch(e){s=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw u}}}},{key:"onInput",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=this._inputFrame,i=this._inputEvent;"number"==typeof r?(i.down=r>0,i.amount=r):(i.down=r,i.amount=r?1:0),i.id=e+"."+t+"."+n;var l=!1,c=void 0,f=void 0,h=void 0,d=!0,p=!1,v=void 0;try{for(var y,_=this._contexts[Symbol.iterator]();!(d=(y=_.next()).done);d=!0){if((f=(c=y.value[0]).getMappedInputs(e,t,n))&&f.length>0){var g=!0,m=!1,w=void 0;try{for(var b,E=f[Symbol.iterator]();!(g=(b=E.next()).done);g=!0){var k=b.value;if(null!=(h=k.processInput(i))){if(k instanceof a.default)o.setAction(k.name);else if(k instanceof s.default)c.setActiveState(k.name,h);else{if(!(k instanceof u.default))throw new Error("Unknown input type '"+result+"'");o.setRange(k.name,h)}l=!0}}}catch(e){m=!0,w=e}finally{try{!g&&E.return&&E.return()}finally{if(m)throw w}}if(l)return!0}}}catch(e){p=!0,v=e}finally{try{!d&&_.return&&_.return()}finally{if(p)throw v}}return!1}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.actions=[],this.states=[],this.ranges=new Map}return r(e,[{key:"setAction",value:function(e){this.actions.push(e)}},{key:"hasAction",value:function(e){return this.actions.includes(e)}},{key:"getAction",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!this.actions.includes(e)&&(t&&this.actions.splice(this.actions.indexOf(e),1),!0)}},{key:"setState",value:function(e){this.states.push(e)}},{key:"hasState",value:function(e){return this.states.includes(e)}},{key:"getState",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!this.states.includes(e)&&(t&&this.states.splice(this.states.indexOf(e),1),!0)}},{key:"setRange",value:function(e,t){this.ranges.set(e,t)}},{key:"hasRange",value:function(e){return this.ranges.has(e)}},{key:"getRange",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.ranges.has(e)){var n=this.ranges.get(e);return t&&this.ranges.delete(e),n}return null}},{key:"clear",value:function(){this.actions.length=0,this.states.length=0,this.ranges.clear()}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._loaders=new Map}return r(e,[{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this._loaders.values()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.clear()}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}this._loaders.clear()}},{key:"registerAssetLoader",value:function(e,t){if("string"!=typeof e)throw new Error("Asset type must be a string");if(this._loaders.has(e))throw new Error("Found already registered loader for type '"+e+"'");this._loaders.set(e,t)}},{key:"getAssetLoader",value:function(e){if("string"!=typeof e)throw new Error("Asset type must be a string");if(!this._loaders.has(e))throw new Error("Cannot find registered loader for type '"+e+"'");return this._loaders.get(e)}},{key:"getAsset",value:function(e,t){return this.getAssetLoader(e).getAsset(t)}},{key:"getAssetImmediately",value:function(e,t){return this.getAssetLoader(e).getAssetImmediately(t)}},{key:"loadAsset",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.getAssetLoader(e).load(t,n)}},{key:"unloadAsset",value:function(e,t){this.getAssetLoader(e).unload(t)}},{key:"cacheAsset",value:function(e,t,n){if(void 0===n)throw new Error("Asset must exist to cache");this.getAssetLoader(e).cache(t,n)}},{key:"loadManifest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.toAssetDataList(),r=[],o=!0,i=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var l=s.value,c=l[0],f=l[1],h=l[2],d=this.getAssetLoader(c).load(f,h);t&&(d=d.catch(function(e){return console.error("Ignoring load error: "+e)})),r.push(d)}}catch(e){i=!0,a=e}finally{try{!o&&u.return&&u.return()}finally{if(i)throw a}}return Promise.all(r)}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=u(n(24)),a=u(n(25)),s=u(n(26));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.nextEntityID=1,e.components=new Map,e.entities=new Set,e.tags=new Map,e.customEntities=new s.default(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"clear",value:function(){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this),this.customEntities.clear(),this.entities.clear(),this.tags.clear();var e=!0,n=!1,r=void 0;try{for(var i,a=this.components.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){i.value.clear()}}catch(e){n=!0,r=e}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"update",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,e),this.customEntities.update(e)}},{key:"registerComponentClass",value:function(e){if(this.components.has(e))throw new Error("Already registered component for '"+e+"'");this.components.set(e,new a.default(e))}},{key:"unregisterComponentClass",value:function(e){if(!this.components.has(e))throw new Error("Cannot find registered component for '"+e+"'");this.components.delete(e)}},{key:"createEntity",value:function(){var e=this.getNextAvailableEntityID();this.entities.add(e);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=!0,i=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var l=s.value;this.addTagToEntity(e,l)}}catch(e){i=!0,a=e}finally{try{!o&&u.return&&u.return()}finally{if(i)throw a}}return e}},{key:"destroyEntity",value:function(e){if(this.entities.has(e)){if(this.isCustomEntity(e)){var t=this.getCustomEntity(e);t.isDead()||(t.setDead(),t.onDestroy())}this.entities.delete(e);var n=!0,r=!1,o=void 0;try{for(var i,a=this.tags.values()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;s.has(e)&&s.delete(e)}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}var u=!0,l=!1,c=void 0;try{for(var f,h=this.components.values()[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){f.value.destroyComponent(e)}}catch(e){l=!0,c=e}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}return!0}return!1}},{key:"hasEntity",value:function(e){return this.entities.has(e)}},{key:"addCustomEntity",value:function(e){return this.customEntities.addEntity(e)}},{key:"getCustomEntity",value:function(e){return this.customEntities.getEntityByID(e)}},{key:"isCustomEntity",value:function(e){return this.customEntities.hasEntityByID(e)}},{key:"addComponentToEntity",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.components.get(t);if(!r)throw new Error("Unable to find registered component manager for class '"+t+"'");var o=r.createComponent(e);return n&&n.apply(null,o),o}},{key:"removeComponentFromEntity",value:function(e,t){var n=this.components.get(t);if(!n)throw new Error("Unable to find registered component manager for class '"+t+"'");return n.destroyComponent(e)}},{key:"getComponentFromEntity",value:function(e,t){var n=this.components.get(e);if(!n)throw new Error("Unable to find registered component manager for class '"+e+"'");return n.getComponent(t)}},{key:"getComponentsFromTag",value:function(e,t){var n=[];if(this.tags.has(t)){var r=void 0,o=this.tags.get(t),i=!0,a=!1,s=void 0;try{for(var u,l=o[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var c=u.value;(r=this.getComponentFromEntity(e,c))&&n.push(r)}}catch(e){a=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}}return n}},{key:"getComponentsByClass",value:function(e){var t=this.components.get(e);if(!t)throw new Error("Unable to find registered component manager for class '"+e+"'");return t.getComponents()}},{key:"getComponentsByEntity",value:function(e){var t=[],n=!0,r=!1,o=void 0;try{for(var i,a=this.components.values()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value.getComponent(e);s&&t.push(s)}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}return t}},{key:"addTagToEntity",value:function(e,t){var n=this.tags.get(t);n||this.tags.set(t,n=new Set),n.add(e)}},{key:"removeTagFromEntity",value:function(e,t){var n=this.tags.get(t);n&&n.has(e)&&n.delete(e)}},{key:"getEntitiesByTag",value:function(e){return this.tags.get(e)}},{key:"getEntities",value:function(){return this.entities}},{key:"getCustomEntities",value:function(){return this.customEntities.getEntities()}},{key:"getNextAvailableEntityID",value:function(){return this.nextEntityID++}}]),t}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.systems=new Map}return r(e,[{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.systems.values()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.terminate()}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}this.systems.clear()}},{key:"update",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.systems.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.update(e)}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}},{key:"addSystem",value:function(e,t){t.setEntityManager(this),t.initialize(),this.systems.set(e,t)}},{key:"removeSystem",value:function(e,t){t.terminate(),t.setEntityManager(null),this.systems.delete(e)}},{key:"getSystem",value:function(e){return this.systems.get(e)}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.componentClass=t,this.componentInstances=new Map,this.cached=[]}return r(e,[{key:"createComponent",value:function(e){var t=this.componentInstances.get(e);return t?(this.componentClass.terminate.call(t,e),this.componentClass.initialize.call(t,e)):(t=this.allocateComponent(),this.componentClass.initialize.call(t,e),this.componentInstances.set(e,t)),t}},{key:"destroyComponent",value:function(e){var t=this.componentInstances.get(e);return!!t&&(this.componentInstances.delete(e),this.componentClass.terminate.call(t,e),this.deallocateComponent(t),!0)}},{key:"getComponent",value:function(e){return this.componentInstances.get(e)}},{key:"getComponents",value:function(){return this.componentInstances.values()}},{key:"allocateComponent",value:function(){if(this.cached.length<=0)for(var e=10;e>=0;--e)this.cached.push({});return this.cached.pop()}},{key:"deallocateComponent",value:function(e){this.cached.push(e)}},{key:"clearCache",value:function(){this.cached.length=0}},{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.componentInstances.values()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;this.deallocateComponent(i)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}this.componentInstances.clear()}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.entityManager=t,this.entities=new Map,this.destroyCache=[],this.createQueue=[],this.createCache=[],this._useCache=!1}return r(e,[{key:"clear",value:function(){this.destroyCache.length=0,this.createCache.length=0,this.createQueue.length=0;var e=!0,t=!1,n=void 0;try{for(var r,o=this.entities.values()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value,a=i.getEntityID();this.entityManager.hasEntity(a)&&(i.isDead()&&(i.onDestroy(),i.setEntityID(-1)),this.entityManager.destroyEntity(a))}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}this.entities.clear()}},{key:"update",value:function(e){this._useCache=!0;for(var t=this.createQueue.length>0,n=100;t;){for(;this.createQueue.length>0&&t;){var r=this.createQueue.shift();if(-1!==r.getEntityID())throw new Error("Entity is already created by another manager");var o=this.entityManager.createEntity("entity");r.setEntityID(o),r.onCreate(this.entityManager),this.entities.set(o,r),--n<0&&(t=!1)}if(this.createCache.length>0){var i=!0,a=!1,s=void 0;try{for(var u,l=this.createCache[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var c=u.value;this.createQueue.unshift(c)}}catch(e){a=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}this.createCache.length=0}else t=!1}this._useCache=!1;var f=!0,h=!1,d=void 0;try{for(var p,v=this.entities.values()[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){var y=p.value;y.isDead()?this.destroyCache.push(y):y.onUpdate(e)}}catch(e){h=!0,d=e}finally{try{!f&&v.return&&v.return()}finally{if(h)throw d}}var _=!0,g=!1,m=void 0;try{for(var w,b=this.destroyCache[Symbol.iterator]();!(_=(w=b.next()).done);_=!0){var E=w.value,k=E.getEntityID();if(this.entityManager.hasEntity(k)){if(E.onDestroy(),!E.isDead())throw new Error("Entity must be dead after onDestroy");this.entityManager.destroyEntity(k)}E.setEntityID(-1),this.entities.delete(k)}}catch(e){g=!0,m=e}finally{try{!_&&b.return&&b.return()}finally{if(g)throw m}}this.destroyCache.length=0}},{key:"addEntity",value:function(e){return this._useCache?this.createCache.unshift(e):this.createQueue.unshift(e),e}},{key:"hasEntityByID",value:function(e){return this.entities.has(e)}},{key:"getEntityByID",value:function(e){return this.entities.get(e)}},{key:"getEntities",value:function(){return this.entities.values()}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(1));var o=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,"text"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),t}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(1));var i=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,"blob"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"onLoadResource",value:function(e,t,n){return new Promise(function(t,n){var r=URL.createObjectURL(e),o=new Image;o.onload=function(){URL.revokeObjectURL(r),t(o)},o.onerror=function(){URL.revokeObjectURL(r),n(new Error("Unable to load image"))},o.src=r})}}]),t}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=a(n(30)),i=a(n(14));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.gl=n,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"onLoadResource",value:function(e,t,n){var r=this;return new Promise(function(e,o){if(!t.geometry)throw new Error("Missing required argument to load asset '"+n+"'");var a=r.gl,s=t.geometry;r.assetManager.getAsset("obj",s).then(function(t){var n=new i.default(a,a.TRIANGLES,t.positions,t.texcoords,t.normals,t.indices);e(n)}).catch(function(e){o(e)})})}},{key:"onUnloadResource",value:function(e,t){e&&e.delete()}}]),t}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(1));var i=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"/","cacheonly"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"load",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],this),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(this._cache.has(e))throw new Error("Asset with url '"+e+"' is already loaded");if(this._loadQueue.has(e))throw new Error("Asset with url '"+e+"' is already loading");var a={promise:null,request:null};return this._cache.set(e,this.getDefaultAsset()),this._loadQueue.set(e,a),a.promise=new Promise(function(a,s){o&&o({loaded:0,total:1}),r.onLoadResource(null,t,e).then(function(t){console.log("[CacheLoader] Successfully loaded cached resource: '"+e+"'."),o&&o({loaded:1,total:1}),r.cache(e,t,!0,!0,!0),a(t)}).catch(function(t){console.log("[CacheLoader] Failed loading cached resource: '"+e+"'."),r.unload(e,i,!0),n&&n(t),s(t)})}),a.promise}},{key:"reload",value:function(e,t){throw new Error("Trying to reload cache-only asset with url '"+e+"'")}}]),t}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(1));function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(e){function t(e,n){return i(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,"text"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"onLoadResource",value:function(e,t,n){return new Promise(function(t,n){try{t(function(e){var t=[],n=[],r=[],o=[],i=[],a=[],u=/v( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g,l=/vn( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g,c=/vt( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g,f=/f( +([\d]+)\/([\d]+)\/([\d]+))( ([\d]+)\/([\d]+)\/([\d]+))( ([\d]+)\/([\d]+)\/([\d]+))( ([\d]+)\/([\d]+)\/([\d]+))?/g,h=/f( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g,d=null,p=void 0,v=void 0,y=void 0,_=void 0;e=e.replace(/^#.*/g,"");for(;null!=(d=u.exec(e));)p=parseFloat(d[1]),v=parseFloat(d[2]),y=parseFloat(d[3]),t.push(p),t.push(v),t.push(y);for(;null!=(d=l.exec(e));)p=parseFloat(d[1]),v=parseFloat(d[2]),y=parseFloat(d[3]),r.push(p),r.push(v),r.push(y);for(;null!=(d=c.exec(e));)p=parseFloat(d[1]),v=parseFloat(d[2]),n.push(p),n.push(v);for(;null!=(d=f.exec(e));)p=parseInt(d[2]),v=parseInt(d[6]),y=parseInt(d[10]),o.push(p),o.push(v),o.push(y),p=parseInt(d[3]),v=parseInt(d[7]),y=parseInt(d[11]),i.push(p),i.push(v),i.push(y),p=parseInt(d[4]),v=parseInt(d[8]),y=parseInt(d[12]),a.push(p),a.push(v),a.push(y),void 0!==d[13]&&(_=parseInt(d[14]),o.push(_),_=parseInt(d[15]),i.push(_),_=parseInt(d[16]),a.push(_));for(;null!=(d=h.exec(e));)p=parseInt(d[2]),v=parseInt(d[6]),y=parseInt(d[10]),o.push(p),o.push(v),o.push(y),i.push(0),i.push(0),i.push(0),a.push(0),a.push(0),a.push(0),void 0!==d[13]&&(_=parseInt(d[14]),o.push(_),i.push(0),a.push(0));var g=void 0,m=void 0;m=o.length;for(var w=new Float32Array(3*m),b=0;b<m;++b)g=o[b]-1,w[3*b+0]=t[3*g+0],w[3*b+1]=t[3*g+1],w[3*b+2]=t[3*g+2];m=i.length;for(var E=new Float32Array(2*m),k=0;k<m;++k)g=i[k]-1,E[2*k+0]=n[2*g+0],E[2*k+1]=n[2*g+1];m=a.length;for(var O=new Float32Array(3*m),S=0;S<m;++S)g=a[S]-1,O[3*S+0]=r[3*g+0],O[3*S+1]=r[3*g+1],O[3*S+2]=r[3*g+2];m=o.length;for(var P=new Uint16Array(m),x=0;x<m;++x)P[x]=x;return new s(w,E,O,P)}(e))}catch(e){n(e)}})}}]),t}();t.default=a;var s=function e(t,n,r,o){i(this,e),this.positions=t,this.texcoords=n,this.normals=r,this.indices=o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),i=f(n(33)),a=(f(n(15)),f(n(14))),s=f(n(34)),u=f(n(35)),l=f(n(36)),c=f(n(37));function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.assets=e,n.shader=null,n.mesh=null,n.cube=null,n.camera=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),r(t,[{key:"load",value:function(e,t){var n=this;if(null!==e){var r=new l.default;this.onPrepareAssets(r),this.assets.loadManifest(r).then(function(){n.onRenderInit(e),t()})}else alert("Unable to initialize WebGL. Your browser may not support it.")}},{key:"unload",value:function(e){this.texture.delete(),this.shader.delete()}},{key:"onPrepareAssets",value:function(e){e.addAsset("vert","shader.vert"),e.addAsset("frag","shader.frag"),e.addAsset("vert","phong.vert"),e.addAsset("frag","phong.frag"),e.addAsset("image","color.png"),e.addAsset("image","capsule.jpg"),e.addAsset("obj","cube.obj"),e.addAsset("obj","capsule.obj"),e.addAsset("obj","quad.obj")}},{key:"onRenderInit",value:function(e){e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.DEPTH_TEST);var t=this.assets,n=new i.default(e,t.getAssetImmediately("vert","phong.vert"),t.getAssetImmediately("frag","phong.frag"));n.setLayout("a_position",3,e.FLOAT,!1),n.setLayout("a_texcoord",2,e.FLOAT,!1),n.setLayout("a_normal",3,e.FLOAT,!1),this.shader=n,this.texture=new s.default(e),this.texture.bindData(t.getAssetImmediately("image","color.png")),this.camera=new c.default(e),this.camera.position[2]=-60,t.loadAsset("mesh","capsule.mesh",{geometry:"capsule.obj"}),t.loadAsset("mesh","quad.mesh",{geometry:"quad.obj"}),t.cacheAsset("mesh","cube.mesh",new a.default(e,e.TRIANGLES,new Float32Array(d),new Float32Array(p),new Float32Array(v),new Uint16Array(y)))}},{key:"render",value:function(e,t){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var n=this.camera.getProjectionMatrix(),r=this.camera.getViewMatrix();e.useProgram(this.shader.handle),e.uniformMatrix4fv(this.shader.uniforms.u_projection,!1,n),e.uniformMatrix4fv(this.shader.uniforms.u_view,!1,r),e.uniform1i(this.shader.uniforms.u_sampler,0),this.texture.bind(e.TEXTURE0),this.renderScene(e,t.getSceneGraph())}},{key:"renderScene",value:function(e,t){var n=this.camera.getViewMatrix(),r=o.mat4.create(),i=o.mat4.create(),a=[];t&&a.push(t);for(var s=0;a.length>0&&!(++s>100);){var u=a.pop(),l=u.mesh;if(l){o.mat4.scale(r,u.worldTransform,u.modelScale),e.uniformMatrix4fv(this.shader.uniforms.u_model,!1,r),o.mat4.mul(i,n,r),o.mat4.invert(i,i),o.mat4.transpose(i,i),e.uniformMatrix4fv(this.shader.uniforms.u_normal,!1,i);var c=this.assets.getAssetImmediately("mesh",l);c.bind(this.shader),c.draw(e)}if(u.isParent())for(var f=u.children.length-1;f>=0;--f)a.push(u.children[f])}}}]),t}(),d=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],p=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],v=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],y=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("Creating shader program...");var o=null,a=null;console.log("...creating vertex shader...");try{o=i(t,t.VERTEX_SHADER,n)}catch(e){throw e}console.log("...creating fragment shader...");try{a=i(t,t.FRAGMENT_SHADER,r)}catch(e){throw t.deleteShader(o),e}console.log("...attaching shaders...");var s=t.createProgram();if(t.attachShader(s,o),t.attachShader(s,a),console.log("...linking shaders..."),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)){var u=t.getProgramInfoLog(s);throw t.detachShader(s,o),t.detachShader(s,a),t.deleteShader(o),t.deleteShader(a),new Error("Unable to initailize shader program: "+u)}for(var l in console.log("...finding attributes..."),this.attributes=function(e,t){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<r;++o){var i=e.getActiveAttrib(t,o),a=i.name,s=e.getAttribLocation(t,a);n[a]=s,console.log("......found attribute '"+a+"'...")}return n}(t,s),console.log("...finding uniforms..."),this.uniforms=function(e,t){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o=0;o<r;++o){var i=e.getActiveUniform(t,o),a=i.name,s=e.getUniformLocation(t,a);n[a]=s,console.log("......found unifrom '"+a+"'...")}return n}(t,s),this._layouts={},this._names={},this.attributes)this._names[this.attributes[l]]=l;this._handle=s,this._vertexShader=o,this._fragmentShader=a,this._gl=t}return r(e,[{key:"delete",value:function(){var e=this._gl,t=this._handle,n=this.attributes;Object.keys(n).forEach(function(e){delete n[e]});var r=this.uniforms;Object.keys(r).forEach(function(e){delete r[e]});var o=this._layouts;Object.keys(o).forEach(function(e){delete o[e]});var i=this._vertexShader;e.detachShader(t,i),e.deleteShader(i),this._vertexShader=0;var a=this._fragmentShader;e.detachShader(t,a),e.deleteShader(a),this._fragmentShader=0,e.deleteProgram(t),this._handle=0}},{key:"validate",value:function(){var e=this._gl,t=this._handle;return e.validateProgram(t),!!e.getProgramParameter(t,e.VALIDATE_STATUS)}},{key:"setLayout",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this._layouts[e]||(this._layouts[e]={});o.vecSize=t,o.dataType=n;var i=function(e,t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.FLOAT:return 4;default:throw new Error("Unknown attrib type '"+t+"'")}}(this._gl,n);return o.typeSize=i,o.normalized=r,o.bytes=i*t,o}},{key:"getLayout",value:function(e){return this._layouts[e]}},{key:"removeLayout",value:function(e){delete this._layouts[e]}},{key:"attachVertexBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if("number"!=typeof e)throw new Error("Missing or unused attribute in shader");var i=this._names[e],a=this._layouts[i];if(!a)throw new Error("Unable to find layout for attribute '"+i+"'");if(a.dataType!==t.dataType)throw new Error("Mismatched data type for attribute '"+i+"'");var s=this._gl;s.bindBuffer(t.type,t.handle),s.vertexAttribPointer(e,a.vecSize,a.dataType,a.normalized,n,r),o&&s.enableVertexAttribArray(e)}},{key:"handle",get:function(){return this._handle}},{key:"vertexShader",get:function(){return this._vertexShader}},{key:"fragmentShader",get:function(){return this._fragmentShader}}]),e}();function i(e,t,n){var r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(r);throw e.deleteShader(r),new Error("An error occured compiling shader: "+o)}return r}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);var r=t.RGBA,o=t.RGBA,i=t.UNSIGNED_BYTE,a=new Uint8Array([255,0,0,255]);t.texImage2D(t.TEXTURE_2D,0,r,1,1,0,o,i,a),this._gl=t,this._handle=n}return r(e,[{key:"delete",value:function(){var e=this._gl,t=this._handle;e.deleteTexture(t),this._handle=0}},{key:"bindData",value:function(e){var t=this._gl,n=this._handle;if(!(e instanceof Image))throw new Error("Unknown image data type is not supported");var r=t.RGBA,o=e.width,a=e.height,s=t.RGBA,u=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,r,s,u,e),i(o)&&i(a)?t.generateMipmap(t.TEXTURE_2D):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR))}},{key:"bind",value:function(e){var t=this._gl,n=this._handle;t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,n)}}]),e}();function i(e){return 0==(e&e-1)}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"load",value:function(e,t){}},{key:"unload",value:function(e){}},{key:"render",value:function(e,t){}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._assets=[]}return r(e,[{key:"clear",value:function(){this._assets.length=0}},{key:"addAsset",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("string"!=typeof e)throw new Error("Asset type must be a string");this._assets.push([e,t,n])}},{key:"removeAsset",value:function(e,t){for(var n=-1,r=(this._assets.length,0);r<lenght;++r)if(assetData[0]===e&&assetData[1]===t){n=r;break}if(!(n>0))throw new Error("Cannot find manifest asset data of type '"+e+"' with url '"+t+"'");this._assets.splice(n,1)}},{key:"toAssetDataList",value:function(){return this._assets.slice()}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(n(38));var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.upVector=o.vec3.fromValues(0,1,0),n.forwardVector=o.vec3.fromValues(0,0,1),n.strafeVector=o.vec3.fromValues(1,0,0),n.eulerRotation=o.quat.create(),n.moveSpeed=.3,n.sensitivity=.1,n.pitch=0,n.yaw=0,n.roll=0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"onUpdate",value:function(e){o.quat.fromEuler(this.rotation,this.pitch,this.yaw,this.roll),o.quat.normalize(this.rotation,this.rotation),this.forwardVector[0]=this._viewMatrix[2],this.forwardVector[1]=this._viewMatrix[6],this.forwardVector[2]=this._viewMatrix[10],this.strafeVector[0]=this._viewMatrix[0],this.strafeVector[1]=this._viewMatrix[4],this.strafeVector[2]=this._viewMatrix[8]}},{key:"updateMove",value:function(e,t,n){this.position[0]+=(this.forwardVector[0]*t+this.strafeVector[0]*e)*this.moveSpeed,this.position[1]+=(this.forwardVector[1]*t+this.strafeVector[1]*e)*this.moveSpeed,this.position[2]+=(this.forwardVector[2]*t+this.strafeVector[2]*e)*this.moveSpeed,this.position[1]+=n*this.moveSpeed}},{key:"updateLook",value:function(e,t){this.pitch+=t*this.sensitivity,this.yaw+=e*this.sensitivity}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this.fieldOfView=45*Math.PI/180,this.zNear=.1,this.zFar=100,this._projectionMatrix=o.mat4.create(),this._viewMatrix=o.mat4.create(),this.transformationMatrix=o.mat4.create(),this.rotationMatrix=o.mat4.create(),this.scaleMatrix=o.mat4.create(),this.inverseRotation=o.quat.create(),this.position=o.vec3.create(),this.rotation=o.quat.create(),this.scale=o.vec3.fromValues(1,1,1)}return r(e,[{key:"getAspectRatio",value:function(){var e=this._gl;return e.canvas.clientWidth/e.canvas.clientHeight}},{key:"getProjectionMatrix",value:function(){return o.mat4.perspective(this._projectionMatrix,this.fieldOfView,this.getAspectRatio(),this.zNear,this.zFar)}},{key:"getViewMatrix",value:function(){return o.mat4.fromTranslation(this.transformationMatrix,this.position),o.mat4.fromQuat(this.rotationMatrix,o.quat.invert(this.inverseRotation,this.rotation)),o.mat4.fromScaling(this.scaleMatrix,this.scale),o.mat4.mul(this._viewMatrix,this.transformationMatrix,this.scaleMatrix),o.mat4.mul(this._viewMatrix,this.rotationMatrix,this._viewMatrix),this._viewMatrix}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),i=u(n(7)),a=u(n(16)),s=u(n(40));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"GameExample2"));return e.renderer=null,e.entityManager=null,e.playerID=-1,e.up=!1,e.down=!1,e.left=!1,e.right=!1,e.forward=!1,e.backward=!1,e.lookX=0,e.lookY=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"onStart",value:function(){(function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onStart",this).call(this);var e=this.getPrevGameState(),n=this.entityManager=e.entityManager;this.renderer=e.renderer,this.sceneGraph;n.registerComponentClass(a.default);var r=n.createEntity(),o=n.addComponentToEntity(r,a.default);o._sceneNode.setParent(this.sceneGraph),o._sceneNode.mesh="cube.mesh",this.playerID=r;var i=n.createEntity("rotating"),u=n.addComponentToEntity(i,a.default);u._sceneNode.setParent(o._sceneNode),u._sceneNode.mesh="capsule.mesh",n.addCustomEntity(new s.default(this))}},{key:"onInputUpdate",value:function(e){this.up=e.getState("moveUp"),this.left=e.getState("strafeLeft"),this.down=e.getState("moveDown"),this.right=e.getState("strafeRight"),this.forward=e.getState("moveForward"),this.backward=e.getState("moveBackward"),e.hasRange("lookX")&&(this.lookX+=-1*e.getRange("lookX")),e.hasRange("lookY")&&(this.lookY+=-1*e.getRange("lookY"))}},{key:"onUpdate",value:function(e){var t=this.entityManager,n=this.renderer,r=this.left!=this.right?this.left?-1:1:0,i=this.forward!=this.backward?this.forward?1:-1:0,s=this.up!=this.down?this.up?-1:1:0;n.camera.onUpdate(e);var u=this.entityManager.getComponentFromEntity(a.default,this.playerID).getTransform();o.mat4.translate(u,u,[r,i,s]);var l=!0,c=!1,f=void 0;try{for(var h,d=t.getComponentsFromTag(a.default,"rotating")[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var p=h.value.getTransform();o.mat4.rotateY(p,p,.01),o.mat4.rotateZ(p,p,.01)}}catch(e){c=!0,f=e}finally{try{!l&&d.return&&d.return()}finally{if(c)throw f}}var v=!0,y=!1,_=void 0;try{for(var g,m=t.getComponentsByClass(a.default)[Symbol.iterator]();!(v=(g=m.next()).done);v=!0){g.value._sceneNode.update(e)}}catch(e){y=!0,_=e}finally{try{!v&&m.return&&m.return()}finally{if(y)throw _}}}}]),t}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=n(0),a=u(n(41)),s=u(n(16));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.world=e,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,[{key:"onCreate",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onCreate",this).call(this,e);var n=this.addComponent(s.default);n._sceneNode.setParent(this.world.sceneGraph),n._sceneNode.mesh="quad.mesh"}},{key:"onUpdate",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onUpdate",this).call(this,e);var n=this.getComponent(s.default).getTransform();i.mat4.rotateX(n,n,.1)}}]),t}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.entityManager=null,this.entityID=-1,this._dead=!1}return r(e,[{key:"setEntityID",value:function(e){this.entityID=e}},{key:"onCreate",value:function(e){this.entityManager=e}},{key:"onUpdate",value:function(e){}},{key:"onDestroy",value:function(){}},{key:"addComponent",value:function(e){return this.entityManager.addComponentToEntity(this.entityID,e)}},{key:"removeComponent",value:function(e){return this.entityManager.removeComponentFromEntity(this.entityID,e)}},{key:"getComponent",value:function(e){return this.entityManager.getComponentFromEntity(e,this.entityID)}},{key:"getEntityID",value:function(){return this.entityID}},{key:"setDead",value:function(){this._dead=!0}},{key:"isDead",value:function(){return this._dead}}]),e}();t.default=o}]);